name: Debug Discord Webhook

on:
  workflow_dispatch:

jobs:
  debug-notification:
    runs-on: ubuntu-latest
    steps:
      - name: Debug and Send
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD }}
        run: |
          echo "Debugging Webhook URL..."
          
          # URLã®é•·ã•ã‚’ãƒã‚§ãƒƒã‚¯
          URL_LEN=${#DISCORD_WEBHOOK_URL}
          echo "URL Length: $URL_LEN"
          
          if [ "$URL_LEN" -lt 10 ]; then
            echo "Error: URL is too short or empty!"
            exit 1
          fi
          
          # URLã®å…ˆé ­ã¨æœ«å°¾ã‚’è¡¨ç¤ºï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ä¸€éƒ¨ã®ã¿ï¼‰
          echo "URL Starts with: ${DISCORD_WEBHOOK_URL:0:35}..."
          echo "URL Ends with: ...${DISCORD_WEBHOOK_URL: -5}"
          
          # curlã§ç›´æ¥é€ä¿¡ã—ã¦ã¿ã‚‹ï¼ˆPythonã‚’ä½¿ã‚ãªã„æœ€ã‚‚åŸå§‹çš„ãªæ–¹æ³•ï¼‰
          echo "Sending test message via curl..."
          curl -H "Content-Type: application/json" \
               -X POST \
               -d '{"content": "ğŸš¨ GitHub Actionsã‹ã‚‰ã®ãƒ†ã‚¹ãƒˆé€šçŸ¥ã§ã™ã€‚ã“ã‚ŒãŒå±Šã‘ã°Secretsã¯æ­£ã—ã„ã§ã™ï¼"}' \
               $DISCORD_WEBHOOK_URL
